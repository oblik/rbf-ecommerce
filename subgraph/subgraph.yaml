specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum
    name: RBFCampaignFactory
    network: base-sepolia
    source:
      address: "0x8180E2B27BC4F01e97Ffc6bbC10b5C679ad716A7"
      abi: RBFCampaignFactory
      startBlock: 30922000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Campaign
        - Business
        - Factory
      abis:
        - name: RBFCampaignFactory
          file: ./abis/RBFCampaignFactory.json
        - name: RBFCampaign
          file: ./abis/RBFCampaign.json
      eventHandlers:
        - event: CampaignCreated(indexed address,indexed address,indexed uint256,uint256,uint256,uint256,uint256,string)
          handler: handleCampaignCreated
        - event: ParametersUpdated(string,uint256,uint256)
          handler: handleParametersUpdated
      file: ./src/factory.ts
# BusinessRegistry temporarily disabled - contract not properly deployed
  # - kind: ethereum
  #   name: BusinessRegistry
  #   network: base-sepolia
  #   source:
  #     address: "0x1b9BE43D71612bd47bca2CeC92055679B5a95167"
  #     abi: BusinessRegistry
  #     startBlock: 30922000
  #   mapping:
  #     kind: ethereum/events
  #     apiVersion: 0.0.7
  #     language: wasm/assemblyscript
  #     entities:
  #       - Business
  #     abis:
  #       - name: BusinessRegistry
  #         file: ./abis/BusinessRegistry.json
  #     eventHandlers:
  #       - event: BusinessRegistered(indexed address,string,string,uint256)
  #         handler: handleBusinessRegistered
  #       - event: BusinessVerified(indexed address,indexed address,uint256)
  #         handler: handleBusinessVerified
  #     file: ./src/registry.ts
templates:
  - kind: ethereum
    name: RBFCampaign
    network: base-sepolia
    source:
      abi: RBFCampaign
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Campaign
        - Contribution
        - Investor
      abis:
        - name: RBFCampaign
          file: ./abis/RBFCampaign.json
      eventHandlers:
        - event: Contributed(indexed address,uint256)
          handler: handleContributed
        - event: FundingGoalReached(uint256)
          handler: handleFundingGoalReached
        - event: RevenueShared(uint256,uint256)
          handler: handleRevenueShared
        - event: ReturnsWithdrawn(indexed address,uint256)
          handler: handleReturnsWithdrawn
        - event: RepaymentCompleted(uint256)
          handler: handleRepaymentCompleted
      file: ./src/campaign.ts