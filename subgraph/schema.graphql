type Factory @entity(immutable: false) {
  id: ID!
  campaignCount: BigInt!
  totalRaised: BigInt!
  campaigns: [Campaign!]! @derivedFrom(field: "factory")
}

type Business @entity(immutable: false) {
  id: ID! # address
  name: String!
  metadataURI: String!
  isRegistered: Boolean!
  isVerified: Boolean!
  verifiedBy: String
  registeredAt: BigInt!
  verifiedAt: BigInt
  campaigns: [Campaign!]! @derivedFrom(field: "business")
  totalRaised: BigInt!
  totalRepaid: BigInt!
  campaignCount: Int!
}

type Campaign @entity(immutable: false) {
  id: ID! # campaign address
  factory: Factory!
  business: Business!
  campaignId: BigInt!
  owner: String!
  metadataURI: String!
  fundingGoal: BigInt!
  totalFunded: BigInt!
  deadline: BigInt!
  revenueSharePercent: BigInt!
  repaymentCap: BigInt!
  fundingActive: Boolean!
  repaymentActive: Boolean!
  totalRepaid: BigInt!
  totalRevenueShared: BigInt!
  createdAt: BigInt!
  contributions: [Contribution!]! @derivedFrom(field: "campaign")
  investors: [Investor!]! @derivedFrom(field: "campaigns")
  contributionCount: Int!
  investorCount: Int!
}

type Contribution @entity(immutable: true) {
  id: ID! # campaign-investor-timestamp
  campaign: Campaign!
  investor: Investor!
  amount: BigInt!
  timestamp: BigInt!
  transactionHash: String!
}

type Investor @entity(immutable: false) {
  id: ID! # investor address
  totalInvested: BigInt!
  totalReturns: BigInt!
  campaigns: [Campaign!]!
  contributions: [Contribution!]! @derivedFrom(field: "investor")
  activeInvestments: Int!
}

type DailySnapshot @entity(immutable: false) {
  id: ID! # day-number
  date: BigInt!
  totalCampaigns: BigInt!
  activeCampaigns: BigInt!
  totalRaised: BigInt!
  totalRepaid: BigInt!
  newCampaigns: BigInt!
  newContributions: BigInt!
  uniqueInvestors: BigInt!
}